# README.md

## 🧠 Migration Assist — Post-Migration Fix Tool

This tool automatically fixes broken Spring Boot code generated by file-by-file LLM migrations (e.g., EJB, JSP, Struts → Spring Boot). It stitches context, corrects wiring, adds annotations, resolves references, and ensures the project builds.

---

## 📦 Structure

```
migration_assist/
├── agents/                  # All fix agents
├── llm/                     # LLM client + prompt handling
├── scripts/                 # Entry points and setup
├── prompts/                # Prompt templates
├── data/                    # mapping.json + embedding index
├── logs/                    # Fix + build logs
├── output/                  # Final code + test cases
├── legacy_codebase/        # Legacy Java source (input)
├── migrated_codebase/      # LLM-generated broken code (input)
├── reference_pairs/        # Hand-migrated samples (input)
├── enterprise_framework_codebase/  # Shared base framework classes
```

---

## 🚀 Setup

```bash
# 1. Create environment and install dependencies
python scripts/init.sh         # macOS/Linux
scripts\init.bat               # Windows

# 2. Place your files:
#    - mapping.json → data/
#    - Java source → legacy_codebase/
#    - Migrated files → migrated_codebase/
#    - Reference pairs → reference_pairs/

# 3. Run fix pipeline
python scripts/run_all_agents.py --migrate-all
```

## 🔐 LLM Configuration (.env)

Create a `.env` file in the project root with:

```env
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-xxxx
OPENAI_ORG=org-xyz

# Or use Azure:
LLM_PROVIDER=azure
AZURE_OPENAI_API_KEY=...
AZURE_OPENAI_ENDPOINT=...
AZURE_OPENAI_API_VERSION=2023-07-01-preview

---

## ⚙️ Agents Overview

| Agent                        | Purpose |
|-----------------------------|---------|
| FileNameClassNameValidator  | Fixes filename ≠ class mismatch, updates mapping |
| MappingLoaderAgent          | Loads normalized mapping.json |
| EmbeddingIndexerAgent       | Builds semantic index of reference/framework code |
| ReferencePromoterAgent      | Finds similar classes for better LLM fixing |
| ContextStitcherAgent        | Assembles multi-file context for fix prompts |
| FixAndCompileAgent          | Core LLM fix logic |
| BuildValidatorAgent         | Runs gradle clean build and checks logs |
| BuildFixerAgent             | Fixes build.gradle using build log errors |
| RetryAgent                  | Retries fix-build cycle up to 3 times |
| TestGeneratorAgent          | Generates unit tests for fixed files |
| FixHistoryLogger            | Logs fix outcome per file |
| JSPToThymeleafResolver      | (Optional) Detects controller/template mismatches |

---

## 📜 Prompts
- `fix_and_compile_prompt.txt`
- `gradle_fix_prompt.txt`
- `test_generation_prompt.txt`
- `reference_extraction_prompt.txt`

All prompts use `{{placeholder}}` formatting and are dynamically populated.

---

## ✅ Outcome
After running the tool:
- All Java files are fixed and saved to `output/fixed_codebase/`
- `build.gradle` is corrected
- `gradle build` passes
- Test cases are generated
- Shim files are added for missing dependencies (if retries fail)
- Full fix logs are stored in `logs/`

---

## 🧠 LLM Support
- OpenAI and Azure OpenAI supported (via env `LLM_PROVIDER`)
- Prompt-safe: cleans markdown, strips commentary, handles 120k token input

---

## 🪛 License
MIT or Custom depending on your distribution needs.
